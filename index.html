<!DOCTYPE html>
<meta charset="utf-8">
<style>
    path {
        stroke: #fff;
        stroke-width: .5px;
    }

    body {
        text-align: center;
    }

    div.tooltip {
        position: absolute;
        text-align: center;
        width: auto;
        height: auto;
        padding: 2px;
        font: 14px sans-serif;
        border: 0px;
        pointer-events: none;
    }

    svg {
        display: block;
        margin: auto;
    }
</style>

<body>
    <script src="jquery-3.4.1.min.js" charset="utf-8"></script>
    <script src="d3.v3.min.js" charset="utf-8"></script>
    <script src="d3.geo.projection.v0.min.js" charset="utf-8"></script>
    <script src="topojson.v1.min.js" charset="utf-8"></script>
    <script>

        var sanctuaryCount = antiSanctuaryCount = noActionCount = 0;

        var isMobileDevice = (typeof window.orientation !== "undefined") || (navigator.userAgent.indexOf('IEMobile') !== -1);

        var width = $(window).width();
        var height = $(window).height();

        var projection = d3.geo.conicConformal()
            .parallels([38 + 02 / 60, 39 + 12 / 60])
            .rotate([78 + 30 / 60, 0])
            .scale(6000)
            .translate([0, 0]);

        var path = d3.geo.path()
            .projection(projection);

        var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height)
            .attr("cursor", "move");

        svg.append("rect")
            .attr("width", "100%")
            .attr("height", "100%")
            .attr("fill", "white");

        var g = svg.append("g")
            .attr("cursor", "pointer");

        var tooltip = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        var sanctuaryIds = [];
        var antiSantuaryIds = [];

        //sanctuaryType: 0 = none, 1 = sanctuary, 2 = anti-sanctuary, 3 = no action
        var getSanctuaryType = function (id) {
            if (id !== 'undefined' && id != "") {
                if (sanctuaryIds.includes(id)) {
                    sanctuaryCount++;
                    return 1;
                }
                else if (
                    antiSantuaryIds.includes(id)) {
                    antiSanctuaryCount++;
                    return 2;
                }
                else {
                    noActionCount++;
                    return 3;
                }
            }
            return 0;
        };

        d3.json("sanctuaries.json", function (error, data) {
            if (error) throw error;
            sanctuaryIds = data.sanctuaryIds;//Load sancuary ids
            d3.json("antisanctuaries.json", function (error, data) {
                if (error) throw error;
                antiSantuaryIds = data.antiSanctuaryIds;//Load anti-sanctuary ids
                d3.json("va-counties.json", function (error, topo) {
                    if (error) throw error;
                    var state = topojson.feature(topo, topo.objects.states),
                        bounds = path.bounds(state),
                        counties = topojson.feature(topo, topo.objects.counties);
                    projection
                        .translate([width / 2 - (bounds[0][0] + bounds[1][0]) / 2, height / 2 - (bounds[0][1] + bounds[1][1]) / 2]);
                    g.selectAll("path")
                        .data(counties.features)
                        .enter().append("path")
                        .attr("d", path)
                        .style("fill", function (d) {
                            switch (getSanctuaryType(d.id)) {
                                case 1:
                                    return "lightskyblue";
                                case 2:
                                    return "lightcoral";
                                case 3:
                                case 0:
                                    return "lightgrey";
                            }
                        })
                        .on("mouseover", function (d) {
                            d3.select(this).style("opacity", .5);
                            tooltip.transition()
                                .duration(200)
                                .style("opacity", .9);
                            tooltip.html(d.properties.name)
                                .style("left", (d3.event.pageX) + "px")
                                .style("top", (d3.event.pageY - 28) + "px");
                        })
                        .on("mouseout", function (d) {
                            d3.select(this).style("opacity", 1);
                            tooltip.transition()
                                .duration(500)
                                .style("opacity", 0);
                        });

                });
            });
        });

        // zoom and pan
        var zoom = d3.behavior.zoom()
            .on("zoom", function () {
                g.attr("transform", "translate(" +
                    d3.event.translate.join(",") + ")scale(" + d3.event.scale + ")");
                g.selectAll("circle")
                    .attr("d", path.projection(projection));
                g.selectAll("path")
                    .attr("d", path.projection(projection));

            });

        svg.call(zoom)

    </script>
</body>
